images:
# x86_64 / AMD64 architecture
- location: "https://cloud-images.ubuntu.com/releases/24.04/release/ubuntu-24.04-server-cloudimg-amd64.img"
  arch: "x86_64"
# ARM64 / aarch64 architecture (Apple Silicon)
- location: "https://cloud-images.ubuntu.com/releases/24.04/release/ubuntu-24.04-server-cloudimg-arm64.img"
  arch: "aarch64"

cpus: 4
memory: "8GiB"
disk: "100GiB"

mounts:
- location: "~"
  writable: true

ssh:
  localPort: 60022
  loadDotSSHPubKeys: true
  forwardAgent: true

provision:
# Install required packages
- mode: system
  script: |
    #!/bin/bash
    set -eux -o pipefail
    export DEBIAN_FRONTEND=noninteractive

    apt-get update
    apt-get install -y build-essential curl git

# Configure sudo permissions for namespace operations
- mode: user
  script: |
    #!/bin/bash
    set -eux -o pipefail

    echo "$USER ALL=(ALL) NOPASSWD: /usr/sbin/useradd, /usr/sbin/userdel, /usr/bin/unshare, /usr/bin/nsenter, /usr/bin/mount, /usr/bin/umount, /usr/bin/pkill, /usr/bin/kill, /usr/bin/chown, /bin/mkdir, /usr/bin/su, /usr/bin/cat" | sudo tee /etc/sudoers.d/lima-environments
    sudo chmod 440 /etc/sudoers.d/lima-environments

